import{d as ne,r as g,y as $,o as se,f as b,g as i,h as _,A as u,z as d,C as c,bB as V,bC as B,m,bE as P,B as G,bD as re,cx as F,_ as ue}from"./index-Dks_UUQM.js";import{D as ie}from"./dutils-CTazb8Sy.js";import de from"./DrawingTool-Cba_syAv.js";const ce={class:"flex flex-col md:flex-row gap-6 p-4 bg-gray-50 shadow mkonva triangle-container"},fe={class:"flex-1"},ge={class:"p-2 flex justify-between items-center border-left-blue border rounded-lg overflow-hidden bg-white"},ve={class:"flex gap-2"},me={class:"stage-container relative"},pe=40,_e=ne({name:"JGeometry",__name:"jtest2",setup(ye){const R=g(null),N=g(null),x=g(null),U=g(!1),J=g({x:0,y:0}),y={width:940,height:680};let O={x:y.width/2,y:y.height/2};const A=g({lines:[],labels:[]}),l=g([]),r=g(-1),w=g(!1),q=g({x:0,y:0}),H=$({draggable:!0,listening:!0}),W=["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsvl(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],j=()=>{const t=Math.random()>.5,e={id:Date.now(),points:[{x:200+l.value.length*30,y:100+l.value.length*30},{x:100+l.value.length*30,y:300+l.value.length*30},{x:300+l.value.length*30,y:300+l.value.length*30}],fillColor:t?"transparent":`hsl(${Math.random()*360}, 70%, 80%)`,strokeColor:`hsl(${Math.random()*360}, 70%, 50%)`,strokeWidth:3,isDashed:!1,dash:[10,5]};l.value.push(e),r.value=l.value.length-1},K=()=>{if(l.value.length<=1){F("至少需要保留一个三角形",{type:"warning"});return}l.value.splice(r.value,1),l.value.length>0&&E(l.value.length-1),F("三角形已删除",{type:"success"})},Q=t=>{t.cancelBubble=!0},X=(t,e,o)=>{var a,s,f;t.target,t.cancelBubble=!0,l.value[e].points[o]={x:t.target.x(),y:t.target.y()},(f=(s=(a=x.value)==null?void 0:a.getNode())==null?void 0:s.getLayer())==null||f.batchDraw()},k=$({x:0,y:0}),Y=(t,e)=>{var s;if(r.value!==e){E(e);return}const o=(s=t.target.getStage())==null?void 0:s.getPointerPosition();if(!o)return;const a=l.value[e].points;I({x:o.x-k.x,y:o.y-k.y},a.map(f=>({x:f.x,y:f.y})))&&(w.value=!0,q.value={x:o.x-k.x,y:o.y-k.y})},Z=(t,e)=>{var o,a,s;w.value&&((s=(a=(o=x.value)==null?void 0:o.getNode())==null?void 0:a.getLayer())==null||s.batchDraw())},S=t=>{w.value=!1},I=(t,e)=>{const[o,a,s]=e,f=C([o,a,s]),D=C([t,o,a]),L=C([t,a,s]),M=C([t,s,o]);return Math.abs(f-(D+L+M))<.5},E=t=>{var e,o,a;if(r.value!=t){const s=l.value.splice(t,1)[0];l.value.push(s),r.value=l.value.length-1,(a=(o=(e=x.value)==null?void 0:e.getNode())==null?void 0:o.getLayer())==null||a.batchDraw()}},C=(t,e=-1)=>{if(t.length!==3)return 0;const[o,a,s]=t;let f=Math.abs((o.x*(a.y-s.y)+a.x*(s.y-o.y)+s.x*(o.y-a.y))/2);return e==-1?f:f.toFixed(e)};return se(()=>{var e;A.value=ie.drawGrid(y.width,y.height,O,pe);const t=(e=R.value)==null?void 0:e.getStage();t&&(t.on("mousemove",o=>{const a=t.getPointerPosition();a&&(J.value={x:Math.round(a.x),y:Math.round(a.y)})}),j())}),(t,e)=>{const o=c("v-line"),a=c("v-text"),s=c("v-circle"),f=c("v-group"),D=c("v-layer"),L=c("v-stage"),M=c("el-button"),T=c("el-color-picker"),h=c("el-form-item"),ee=c("el-slider"),le=c("el-switch"),te=c("el-form"),oe=c("el-card");return i(),b("div",ce,[_("div",fe,[_("div",ge,[e[5]||(e[5]=_("div",{class:"text-sm font-medium text-gray-700 bg-gray"}," 探索三角形图像变化规律 ",-1)),_("div",ve,[u(de,{enableDrawing:U.value,"onUpdate:enableDrawing":e[0]||(e[0]=n=>U.value=n),stageRef:R.value,drawingLayerRef:N.value},null,8,["enableDrawing","stageRef","drawingLayerRef"])])]),_("div",me,[u(L,{ref_key:"stageRef",ref:R,config:y},{default:d(()=>[u(D,{ref_key:"layerRef",ref:x},{default:d(()=>[(i(!0),b(V,null,B(A.value.lines,(n,p)=>(i(),m(o,{key:"grid-"+p,config:n},null,8,["config"]))),128)),(i(!0),b(V,null,B(A.value.labels,(n,p)=>(i(),m(a,{key:"axe-label-"+p,config:n},null,8,["config"]))),128)),(i(!0),b(V,null,B(l.value,(n,p)=>(i(),m(f,{key:n.id,ref_for:!0,ref:"triangleGroup",config:H,onMousedown:v=>Y(v,p),onDragmove:v=>Z(v,p),onMouseup:S,onMouseleave:S},{default:d(()=>[u(o,{config:{points:n.points.flatMap(v=>[v.x,v.y]),fill:n.fillColor,stroke:n.strokeColor,strokeWidth:n.strokeWidth,dash:n.isDashed?n.dash:void 0,closed:!0}},null,8,["config"]),(i(!0),b(V,null,B(n.points,(v,z)=>(i(),m(s,{key:z,config:{x:v.x,y:v.y,radius:5,fill:n.strokeColor,stroke:"#fff",strokeWidth:2,draggable:!0,istening:!w.value},onMousedown:Q,onDragmove:ae=>X(ae,p,z)},null,8,["config","onDragmove"]))),128))]),_:2},1032,["config","onMousedown","onDragmove"]))),128))]),_:1},512),u(D,{ref_key:"drawingLayerRef",ref:N},null,512)]),_:1},512)])]),u(oe,{class:"control-panel w-full md:w-120 space-y-2"},{header:d(()=>[e[7]||(e[7]=_("span",{class:"mr-5"},"三角形控制面板",-1)),u(M,{type:"primary",size:"small",onClick:j},{default:d(()=>e[6]||(e[6]=[G(" 添加三角形 ")])),_:1,__:[6]})]),default:d(()=>[u(te,{"label-width":"80px"},{default:d(()=>[r.value!=-1?(i(),m(h,{key:0,label:"填充颜色"},{default:d(()=>[u(T,{modelValue:l.value[r.value].fillColor,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value[r.value].fillColor=n),predefine:W},null,8,["modelValue"])]),_:1})):P("",!0),r.value!=-1?(i(),m(h,{key:1,label:"边框颜色"},{default:d(()=>[u(T,{modelValue:l.value[r.value].strokeColor,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value[r.value].strokeColor=n),predefine:W},null,8,["modelValue"])]),_:1})):P("",!0),r.value!=-1?(i(),m(h,{key:2,label:"边框宽度"},{default:d(()=>[u(ee,{modelValue:l.value[r.value].strokeWidth,"onUpdate:modelValue":e[3]||(e[3]=n=>l.value[r.value].strokeWidth=n),min:1,max:10,step:1},null,8,["modelValue"])]),_:1})):P("",!0),r.value!=-1?(i(),m(h,{key:3,label:"是否虚线"},{default:d(()=>[u(le,{modelValue:l.value[r.value].isDashed,"onUpdate:modelValue":e[4]||(e[4]=n=>l.value[r.value].isDashed=n)},null,8,["modelValue"]),e[8]||(e[8]=G(" 虚线边框 "))]),_:1,__:[8]})):P("",!0),u(h,null,{default:d(()=>[u(M,{type:"danger",disabled:l.value.length<=0,onClick:re(K,["stop"])},{default:d(()=>e[9]||(e[9]=[G(" 删除 ")])),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1})]),_:1})])}}}),we=ue(_e,[["__scopeId","data-v-61a294df"]]);export{we as default};
