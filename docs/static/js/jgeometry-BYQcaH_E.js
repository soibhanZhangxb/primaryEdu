import{d as ee,r as c,y as A,o as le,f as y,g as r,h as p,A as a,z as n,C as u,bB as h,bC as R,m,bE as B,B as k,bD as oe,cx as F,_ as te}from"./index-Dks_UUQM.js";import{D as ae}from"./dutils-CTazb8Sy.js";import se from"./DrawingTool-Cba_syAv.js";const ne={class:"flex flex-col md:flex-row gap-6 p-4 bg-gray-50 shadow mkonva triangle-container"},re={class:"flex-1"},ue={class:"p-2 flex justify-between items-center border-left-blue border rounded-lg overflow-hidden bg-white"},ie={class:"flex gap-2"},de={class:"stage-container relative"},fe=40,ve=ee({name:"JGeometry",__name:"jgeometry",setup(ge){const W=c(null),U=c(null),L=c(null),z=c(!1),J=c({x:0,y:0}),b={width:940,height:680};let x={x:b.width/2,y:b.height/2};const T=c({lines:[],labels:[]}),o=c([]),s=c(-1),_=A({x:0,y:0}),X=A({draggable:!0,listening:!0,hitFunc:t=>{const e=this.getClientRect();t.rect(e.x,e.y,e.width,e.height)}}),G=["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsvl(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],w=t=>{let e=[{x:200+o.value.length*30,y:100+o.value.length*30},{x:100+o.value.length*30,y:300+o.value.length*30},{x:300+o.value.length*30,y:300+o.value.length*30},{x:400+o.value.length*30,y:100+o.value.length*30}];const i={id:Date.now(),x:x.x,y:x.y,x2:x.x,y2:x.y,radius:t>1?0:100+o.value.length*5,points:e.slice(0,t),fillColor:"transparent",strokeColor:`hsl(${Math.random()*360}, 70%, 50%)`,strokeWidth:3,isDashed:!1,dash:[10,5]};o.value.push(i),s.value=o.value.length-1},Y=()=>{if(o.value.length<=1){F("至少需要保留一个三角形",{type:"warning"});return}o.value.splice(s.value,1),o.value.length>0&&E(o.value.length-1),F("三角形已删除",{type:"success"})},$=t=>{t.cancelBubble=!0,_.x=t.target.x(),_.y=t.target.y()},j=(t,e,i)=>{var d,g,V;if(t.target,t.cancelBubble=!0,i>-1&&o.value[e].radius==0)o.value[e].points[i]={x:t.target.x(),y:t.target.y()};else{let M=t.target.x()-_.x,N=t.target.y()-_.y;_.x=t.target.x(),_.y=t.target.y(),o.value[e].radius+=(M+N)/2}(V=(g=(d=L.value)==null?void 0:d.getNode())==null?void 0:g.getLayer())==null||V.batchDraw()},q=(t,e)=>{o.value[e].x2-=1e-4,o.value[e].y2-=1e-4},H=(t,e)=>{s.value!==e&&E(e),t.cancelBubble=!0},E=t=>{var e,i,d;if(s.value!=t){const g=o.value.splice(t,1)[0];o.value.push(g),s.value=o.value.length-1,(d=(i=(e=L.value)==null?void 0:e.getNode())==null?void 0:i.getLayer())==null||d.batchDraw()}};return le(()=>{var e;T.value=ae.drawGrid(b.width,b.height,x,fe);const t=(e=W.value)==null?void 0:e.getStage();t&&(t.on("mousemove",i=>{const d=t.getPointerPosition();d&&(J.value={x:Math.round(d.x),y:Math.round(d.y)})}),w(3))}),(t,e)=>{const i=u("v-line"),d=u("v-text"),g=u("v-circle"),V=u("v-group"),M=u("v-layer"),N=u("v-stage"),C=u("el-button"),P=u("el-color-picker"),D=u("el-form-item"),K=u("el-slider"),O=u("el-switch"),Q=u("el-form"),Z=u("el-card");return r(),y("div",ne,[p("div",re,[p("div",ue,[e[9]||(e[9]=p("div",{class:"text-sm font-medium text-gray-700 bg-gray"}," 探索三角形图像变化规律 ",-1)),p("div",ie,[a(se,{enableDrawing:z.value,"onUpdate:enableDrawing":e[0]||(e[0]=l=>z.value=l),stageRef:W.value,drawingLayerRef:U.value},null,8,["enableDrawing","stageRef","drawingLayerRef"])])]),p("div",de,[a(N,{ref_key:"stageRef",ref:W,config:b},{default:n(()=>[a(M,{ref_key:"layerRef",ref:L},{default:n(()=>[(r(!0),y(h,null,R(T.value.lines,(l,v)=>(r(),m(i,{key:"grid-"+v,config:l},null,8,["config"]))),128)),(r(!0),y(h,null,R(T.value.labels,(l,v)=>(r(),m(d,{key:"axe-label-"+v,config:l},null,8,["config"]))),128)),(r(!0),y(h,null,R(o.value,(l,v)=>(r(),m(V,{key:l.id,ref_for:!0,ref:"triangleGroup",config:X,onMousedown:f=>H(f,v)},{default:n(()=>[o.value[v].radius==0?(r(),y(h,{key:0},[a(i,{config:{points:l.points.flatMap(f=>[f.x,f.y]),fill:l.fillColor,stroke:l.strokeColor,strokeWidth:l.strokeWidth,dash:l.isDashed?l.dash:void 0,closed:!0}},null,8,["config"]),(r(!0),y(h,null,R(l.points,(f,S)=>(r(),m(g,{key:S,config:{x:f.x,y:f.y,radius:5,fill:l.strokeColor,stroke:"#fff",strokeWidth:2,draggable:!0,istening:!1},onMousedown:$,onDragmove:I=>j(I,v,S)},null,8,["config","onDragmove"]))),128))],64)):(r(),y(h,{key:1},[a(g,{config:{x:l.x,y:l.y,radius:l.radius,fill:l.fillColor,stroke:l.strokeColor,strokeWidth:l.strokeWidth,dash:l.isDashed?l.dash:void 0}},null,8,["config"]),a(g,{config:{x:l.x2,y:l.y2,radius:5,fill:l.strokeColor,stroke:l.strokeColor,strokeWidth:l.strokeWidth,draggable:!0,istening:!1},onMousedown:$,onDragmove:f=>j(f,v,-1),onDragend:f=>q(f,v)},null,8,["config","onDragmove","onDragend"])],64))]),_:2},1032,["config","onMousedown"]))),128))]),_:1},512),a(M,{ref_key:"drawingLayerRef",ref:U},null,512)]),_:1},512)])]),a(Z,{class:"control-panel w-full md:w-120 space-y-2"},{header:n(()=>[e[14]||(e[14]=p("div",{class:"mr-5"},"控制面板",-1)),p("div",null,[a(C,{type:"primary",size:"small",onClick:e[1]||(e[1]=l=>w(3))},{default:n(()=>e[10]||(e[10]=[k(" 三角形 ")])),_:1,__:[10]}),a(C,{type:"primary",size:"small",onClick:e[2]||(e[2]=l=>w(4))},{default:n(()=>e[11]||(e[11]=[k(" 四边形 ")])),_:1,__:[11]}),a(C,{type:"primary",size:"small",onClick:e[3]||(e[3]=l=>w(2))},{default:n(()=>e[12]||(e[12]=[k(" 线段 ")])),_:1,__:[12]}),a(C,{type:"primary",size:"small",onClick:e[4]||(e[4]=l=>w(1))},{default:n(()=>e[13]||(e[13]=[k(" 圆 ")])),_:1,__:[13]})])]),default:n(()=>[a(Q,{"label-width":"80px"},{default:n(()=>[s.value!=-1?(r(),m(D,{key:0,label:"填充颜色"},{default:n(()=>[a(P,{modelValue:o.value[s.value].fillColor,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value[s.value].fillColor=l),predefine:G},null,8,["modelValue"])]),_:1})):B("",!0),s.value!=-1?(r(),m(D,{key:1,label:"边框颜色"},{default:n(()=>[a(P,{modelValue:o.value[s.value].strokeColor,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value[s.value].strokeColor=l),predefine:G},null,8,["modelValue"])]),_:1})):B("",!0),s.value!=-1?(r(),m(D,{key:2,label:"边框宽度"},{default:n(()=>[a(K,{modelValue:o.value[s.value].strokeWidth,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value[s.value].strokeWidth=l),min:1,max:10,step:1},null,8,["modelValue"])]),_:1})):B("",!0),s.value!=-1?(r(),m(D,{key:3,label:"是否虚线"},{default:n(()=>[a(O,{modelValue:o.value[s.value].isDashed,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value[s.value].isDashed=l)},null,8,["modelValue"]),e[15]||(e[15]=k(" 虚框 "))]),_:1,__:[15]})):B("",!0),a(D,null,{default:n(()=>[a(C,{type:"danger",disabled:o.value.length<=0,onClick:oe(Y,["stop"])},{default:n(()=>e[16]||(e[16]=[k(" 删除 ")])),_:1,__:[16]},8,["disabled"])]),_:1})]),_:1})]),_:1})])}}}),pe=te(ve,[["__scopeId","data-v-35b52ac0"]]);export{pe as default};
